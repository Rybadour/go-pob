var Gt=Object.defineProperty;var qt=(e,t,n)=>t in e?Gt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var C=(e,t,n)=>(qt(e,typeof t!="symbol"?t+"":t,n),n);import{S as Xe,i as Ge,s as qe,W as bt,k as we,a as vt,l as _e,m as be,h as z,c as It,n as V,p as W,b as re,G as f,a7 as Ce,R as T,X as kt,Y as St,Z as Lt,g as U,d as ee,I as Et,ad as jt,o as st,a2 as Rt,ae as Bt,ac as y,w as $e,N as Ze,O as zt,v as At,f as Mt,J as fe,$ as Jt,y as it,z as at,A as rt,E as Ut,B as ot,e as ft}from"../chunks/index.3d9c3a98.js";import{r as Vt,w as lt}from"../chunks/index.6c284d28.js";import{s as et,c as Wt}from"../chunks/global.4e98742d.js";class Ht{constructor(){C(this,"currentLayerId");C(this,"setups");C(this,"renderers");C(this,"dispatchers");C(this,"needsSetup");C(this,"needsRedraw");C(this,"context");C(this,"width");C(this,"height");C(this,"autoclear");C(this,"pixelRatio");C(this,"renderLoop");C(this,"layerObserver");C(this,"layerRef");C(this,"layerSequence");C(this,"renderingLayerId");C(this,"activeLayerId");C(this,"activeLayerDispatcher");this.register=this.register.bind(this),this.unregister=this.unregister.bind(this),this.redraw=this.redraw.bind(this),this.getRenderingLayerId=this.getRenderingLayerId.bind(this),this.currentLayerId=1,this.setups=new Map,this.renderers=new Map,this.dispatchers=new Map,this.needsSetup=!1,this.needsRedraw=!0,this.renderingLayerId=0,this.activeLayerId=0,this.layerSequence=[]}redraw(){this.needsRedraw=!0}register({setup:t,render:n,dispatcher:a}){return t&&(this.setups.set(this.currentLayerId,t),this.needsSetup=!0),this.renderers.set(this.currentLayerId,n),this.dispatchers.set(this.currentLayerId,a),this.needsRedraw=!0,this.currentLayerId++}unregister(t){this.renderers.delete(t),this.dispatchers.delete(t),this.needsRedraw=!0}setup(t,n){this.context=t,this.layerRef=n,this.observeLayerSequence(),this.startRenderLoop()}observeLayerSequence(){this.layerObserver=new MutationObserver(this.getLayerSequence.bind(this)),this.layerObserver.observe(this.layerRef,{childList:!0}),this.getLayerSequence()}getLayerSequence(){const t=[...this.layerRef.children];this.layerSequence=t.map(n=>+(n.dataset.layerId??-1)),this.redraw()}startRenderLoop(){this.render(),this.renderLoop=requestAnimationFrame(()=>this.startRenderLoop())}render(){var u;const t=this.context,n=this.width,a=this.height,c=this.pixelRatio;if(this.needsSetup){for(const[l,r]of this.setups)r({context:t,width:n,height:a}),this.setups.delete(l);this.needsSetup=!1}if(this.needsRedraw){t.setTransform(c,0,0,c,0,0),this.autoclear&&t.clearRect(0,0,n,a);for(const l of this.layerSequence)this.renderingLayerId=l,(u=this.renderers.get(l))==null||u({context:t,width:n,height:a});this.needsRedraw=!1}}setActiveLayer(t,n){this.activeLayerId!==t&&(n instanceof MouseEvent&&(this.dispatchLayerEvent(new PointerEvent("pointerleave",n)),this.dispatchLayerEvent(new MouseEvent("mouseleave",n))),this.activeLayerId=t,this.activeLayerDispatcher=this.dispatchers.get(t),n instanceof MouseEvent&&(this.dispatchLayerEvent(new PointerEvent("pointerenter",n)),this.dispatchLayerEvent(new MouseEvent("mouseenter",n))))}dispatchLayerEvent(t){if(this.activeLayerDispatcher){if(window.TouchEvent&&t instanceof TouchEvent){const{left:n,top:a}=t.target.getBoundingClientRect(),{clientX:c,clientY:u}=t.changedTouches[0],l={x:c-n,y:u-a,originalEvent:t};this.activeLayerDispatcher(t.type,l)}else if(t instanceof MouseEvent){const n={x:t.offsetX,y:t.offsetY,originalEvent:t};this.activeLayerDispatcher(t.type,n)}}}getRenderingLayerId(){return this.renderingLayerId}destroy(){typeof window>"u"||(this.layerObserver.disconnect(),cancelAnimationFrame(this.renderLoop))}}const Kt=e=>{const t=e*2,n=t>>16&255,a=t>>8&255,c=t&255;return`rgb(${n}, ${a}, ${c})`},Zt=(e,t,n)=>{const a=(e<<16|t<<8|n)/2;return a%1?0:a},Qt=["drawImage"],xt=["filter","shadowBlur","globalCompositeOperation","globalAlpha"],$t=["drawImage","fill","fillRect","fillText","stroke","strokeRect","strokeText"],en=e=>{let t;const n=document.createElement("canvas"),a=n.getContext("2d",{willReadFrequently:!0}),c=()=>{n.width=e.canvas.width,n.height=e.canvas.height};return new MutationObserver(c).observe(e.canvas,{attributeFilter:["width","height"]}),c(),new Proxy(e,{get(l,r){if(r==="_getLayerIdAtPixel")return(g,E)=>{const[k,b,p]=a.getImageData(g,E,1,1).data;return Zt(k,b,p)};const h=l[r];return typeof h!="function"?h:function(...g){if($t.includes(r)){const E=Kt(t());a.fillStyle=E,a.strokeStyle=E}if(r==="drawImage"){const E=g.slice(1);a.fillRect(...E)}return Qt.includes(r)||Reflect.apply(h,a,g),Reflect.apply(h,l,g)}},set(l,r,h){return r==="_renderingLayerId"?(t=h,!0):(l[r]=h,xt.includes(r)||(a[r]=h),!0)}})};function tn(e){let t,n,a,c=`${e[0]}px`,u=`${e[1]}px`,l,r,h,g,E;const k=e[18].default,b=bt(k,e,e[17],null);return{c(){t=we("canvas"),l=vt(),r=we("div"),b&&b.c(),this.h()},l(p){t=_e(p,"CANVAS",{width:!0,height:!0,class:!0,style:!0}),be(t).forEach(z),l=It(p),r=_e(p,"DIV",{});var v=be(r);b&&b.l(v),v.forEach(z),this.h()},h(){V(t,"width",n=e[0]*e[5]),V(t,"height",a=e[1]*e[5]),V(t,"class",e[4]),V(t,"style",e[2]),W(t,"display","block"),W(t,"width",c),W(t,"height",u),W(r,"display","none")},m(p,v){re(p,t,v),e[64](t),re(p,l,v),re(p,r,v),b&&b.m(r,null),e[65](r),h=!0,g||(E=[f(t,"touchstart",Ce(function(){T(e[3]?e[9]:null)&&(e[3]?e[9]:null).apply(this,arguments)})),f(t,"mousemove",function(){T(e[3]?e[8]:null)&&(e[3]?e[8]:null).apply(this,arguments)}),f(t,"pointermove",function(){T(e[3]?e[8]:null)&&(e[3]?e[8]:null).apply(this,arguments)}),f(t,"click",function(){T(e[3]?e[10]:null)&&(e[3]?e[10]:null).apply(this,arguments)}),f(t,"contextmenu",function(){T(e[3]?e[10]:null)&&(e[3]?e[10]:null).apply(this,arguments)}),f(t,"dblclick",function(){T(e[3]?e[10]:null)&&(e[3]?e[10]:null).apply(this,arguments)}),f(t,"mousedown",function(){T(e[3]?e[10]:null)&&(e[3]?e[10]:null).apply(this,arguments)}),f(t,"mouseenter",function(){T(e[3]?e[10]:null)&&(e[3]?e[10]:null).apply(this,arguments)}),f(t,"mouseleave",function(){T(e[3]?e[10]:null)&&(e[3]?e[10]:null).apply(this,arguments)}),f(t,"mouseup",function(){T(e[3]?e[10]:null)&&(e[3]?e[10]:null).apply(this,arguments)}),f(t,"wheel",function(){T(e[3]?e[10]:null)&&(e[3]?e[10]:null).apply(this,arguments)}),f(t,"touchcancel",Ce(function(){T(e[3]?e[10]:null)&&(e[3]?e[10]:null).apply(this,arguments)})),f(t,"touchend",Ce(function(){T(e[3]?e[10]:null)&&(e[3]?e[10]:null).apply(this,arguments)})),f(t,"touchmove",Ce(function(){T(e[3]?e[10]:null)&&(e[3]?e[10]:null).apply(this,arguments)})),f(t,"pointerenter",function(){T(e[3]?e[10]:null)&&(e[3]?e[10]:null).apply(this,arguments)}),f(t,"pointerleave",function(){T(e[3]?e[10]:null)&&(e[3]?e[10]:null).apply(this,arguments)}),f(t,"pointerdown",function(){T(e[3]?e[10]:null)&&(e[3]?e[10]:null).apply(this,arguments)}),f(t,"pointerup",function(){T(e[3]?e[10]:null)&&(e[3]?e[10]:null).apply(this,arguments)}),f(t,"pointercancel",function(){T(e[3]?e[10]:null)&&(e[3]?e[10]:null).apply(this,arguments)}),f(t,"focus",e[19]),f(t,"blur",e[20]),f(t,"fullscreenchange",e[21]),f(t,"fullscreenerror",e[22]),f(t,"scroll",e[23]),f(t,"cut",e[24]),f(t,"copy",e[25]),f(t,"paste",e[26]),f(t,"keydown",e[27]),f(t,"keypress",e[28]),f(t,"keyup",e[29]),f(t,"auxclick",e[30]),f(t,"click",e[31]),f(t,"contextmenu",e[32]),f(t,"dblclick",e[33]),f(t,"mousedown",e[34]),f(t,"mouseenter",e[35]),f(t,"mouseleave",e[36]),f(t,"mousemove",e[37]),f(t,"mouseover",e[38]),f(t,"mouseout",e[39]),f(t,"mouseup",e[40]),f(t,"select",e[41]),f(t,"wheel",e[42]),f(t,"drag",e[43]),f(t,"dragend",e[44]),f(t,"dragenter",e[45]),f(t,"dragstart",e[46]),f(t,"dragleave",e[47]),f(t,"dragover",e[48]),f(t,"drop",e[49]),f(t,"touchcancel",e[50]),f(t,"touchend",e[51]),f(t,"touchmove",e[52]),f(t,"touchstart",e[53]),f(t,"pointerover",e[54]),f(t,"pointerenter",e[55]),f(t,"pointerdown",e[56]),f(t,"pointermove",e[57]),f(t,"pointerup",e[58]),f(t,"pointercancel",e[59]),f(t,"pointerout",e[60]),f(t,"pointerleave",e[61]),f(t,"gotpointercapture",e[62]),f(t,"lostpointercapture",e[63])],g=!0)},p(p,v){e=p,(!h||v[0]&33&&n!==(n=e[0]*e[5]))&&V(t,"width",n),(!h||v[0]&34&&a!==(a=e[1]*e[5]))&&V(t,"height",a),(!h||v[0]&16)&&V(t,"class",e[4]),(!h||v[0]&4)&&V(t,"style",e[2]);const w=v[0]&4;w&&W(t,"display","block"),(w||v[0]&5&&c!==(c=`${e[0]}px`))&&W(t,"width",c),(w||v[0]&6&&u!==(u=`${e[1]}px`))&&W(t,"height",u),b&&b.p&&(!h||v[0]&131072)&&kt(b,k,e,e[17],h?Lt(k,e[17],v,null):St(e[17]),null)},i(p){h||(U(b,p),h=!0)},o(p){ee(b,p),h=!1},d(p){p&&z(t),e[64](null),p&&z(l),p&&z(r),b&&b.d(p),e[65](null),g=!1,Et(E)}}}const Nt=Symbol(),nn=()=>Bt(Nt);function sn(e,t,n){let a,{$$slots:c={},$$scope:u}=t,{width:l=640,height:r=640,pixelRatio:h=null,style:g="",autoclear:E=!0,layerEvents:k=!1}=t,{class:b=""}=t,p,v=null,w;const m=new Ht;function F(){m.redraw()}function H(){return p}function te(){return v}h==null&&(typeof window<"u"?h=window.devicePixelRatio:h=2),jt(Nt,{register:m.register,unregister:m.unregister,redraw:m.redraw}),st(()=>{const s=p.getContext("2d");k?(v=en(s),v._renderingLayerId=m.getRenderingLayerId):v=s,m.setup(v,w)}),Rt(()=>m.destroy());const I=s=>{const me=s.offsetX*a,ue=s.offsetY*a,Ke=v._getLayerIdAtPixel(me,ue);m.setActiveLayer(Ke,s),m.dispatchLayerEvent(s)},je=s=>{const{clientX:me,clientY:ue}=s.changedTouches[0],{left:Ke,top:Dt}=p.getBoundingClientRect(),Ft=(me-Ke)*a,Yt=(ue-Dt)*a,Xt=v._getLayerIdAtPixel(Ft,Yt);m.setActiveLayer(Xt,s),m.dispatchLayerEvent(s)},D=s=>{window.TouchEvent&&s instanceof TouchEvent&&s.preventDefault(),m.dispatchLayerEvent(s)};function he(s){y.call(this,e,s)}function le(s){y.call(this,e,s)}function Y(s){y.call(this,e,s)}function X(s){y.call(this,e,s)}function ve(s){y.call(this,e,s)}function Ie(s){y.call(this,e,s)}function ke(s){y.call(this,e,s)}function Se(s){y.call(this,e,s)}function de(s){y.call(this,e,s)}function Be(s){y.call(this,e,s)}function ze(s){y.call(this,e,s)}function Je(s){y.call(this,e,s)}function Ue(s){y.call(this,e,s)}function K(s){y.call(this,e,s)}function Le(s){y.call(this,e,s)}function Ee(s){y.call(this,e,s)}function ce(s){y.call(this,e,s)}function ye(s){y.call(this,e,s)}function Ve(s){y.call(this,e,s)}function i(s){y.call(this,e,s)}function J(s){y.call(this,e,s)}function Z(s){y.call(this,e,s)}function Q(s){y.call(this,e,s)}function G(s){y.call(this,e,s)}function B(s){y.call(this,e,s)}function ne(s){y.call(this,e,s)}function R(s){y.call(this,e,s)}function o(s){y.call(this,e,s)}function d(s){y.call(this,e,s)}function S(s){y.call(this,e,s)}function _(s){y.call(this,e,s)}function O(s){y.call(this,e,s)}function A(s){y.call(this,e,s)}function q(s){y.call(this,e,s)}function L(s){y.call(this,e,s)}function j(s){y.call(this,e,s)}function M(s){y.call(this,e,s)}function pe(s){y.call(this,e,s)}function Re(s){y.call(this,e,s)}function Ae(s){y.call(this,e,s)}function Me(s){y.call(this,e,s)}function x(s){y.call(this,e,s)}function $(s){y.call(this,e,s)}function Ne(s){y.call(this,e,s)}function We(s){y.call(this,e,s)}function He(s){$e[s?"unshift":"push"](()=>{p=s,n(6,p)})}function Pe(s){$e[s?"unshift":"push"](()=>{w=s,n(7,w)})}return e.$$set=s=>{"width"in s&&n(0,l=s.width),"height"in s&&n(1,r=s.height),"pixelRatio"in s&&n(11,h=s.pixelRatio),"style"in s&&n(2,g=s.style),"autoclear"in s&&n(12,E=s.autoclear),"layerEvents"in s&&n(3,k=s.layerEvents),"class"in s&&n(4,b=s.class),"$$scope"in s&&n(17,u=s.$$scope)},e.$$.update=()=>{e.$$.dirty[0]&2048&&n(5,a=h??1),e.$$.dirty[0]&1&&n(16,m.width=l,m),e.$$.dirty[0]&2&&n(16,m.height=r,m),e.$$.dirty[0]&32&&n(16,m.pixelRatio=a,m),e.$$.dirty[0]&4096&&n(16,m.autoclear=E,m),e.$$.dirty[0]&71683&&m.redraw()},[l,r,g,k,b,a,p,w,I,je,D,h,E,F,H,te,m,u,c,he,le,Y,X,ve,Ie,ke,Se,de,Be,ze,Je,Ue,K,Le,Ee,ce,ye,Ve,i,J,Z,Q,G,B,ne,R,o,d,S,_,O,A,q,L,j,M,pe,Re,Ae,Me,x,$,Ne,We,He,Pe]}class an extends Xe{constructor(t){super(),Ge(this,t,sn,tn,qe,{width:0,height:1,pixelRatio:11,style:2,autoclear:12,layerEvents:3,class:4,redraw:13,getCanvas:14,getContext:15},null,[-1,-1,-1])}get redraw(){return this.$$.ctx[13]}get getCanvas(){return this.$$.ctx[14]}get getContext(){return this.$$.ctx[15]}}function rn(e){let t;return{c(){t=we("div"),this.h()},l(n){t=_e(n,"DIV",{"data-layer-id":!0}),be(t).forEach(z),this.h()},h(){V(t,"data-layer-id",e[0])},m(n,a){re(n,t,a)},p:Ze,i:Ze,o:Ze,d(n){n&&z(t)}}}function on(e,t,n){const{register:a,unregister:c,redraw:u}=nn(),l=zt();let{setup:r=void 0}=t,{render:h=()=>{}}=t;const g=a({setup:r,render:h,dispatcher:l});return Rt(()=>c(g)),e.$$set=E=>{"setup"in E&&n(1,r=E.setup),"render"in E&&n(2,h=E.render)},e.$$.update=()=>{e.$$.dirty&4&&u()},[g,r,h]}class ln extends Xe{constructor(t){super(),Ge(this,t,on,rn,qe,{setup:1,render:2})}}let ht;const Pt=Date.now(),Ct=e=>(e(Date.now()-Pt),ht=window.requestAnimationFrame(()=>Ct(e)),()=>window.cancelAnimationFrame(ht));function cn(){}Vt(Date.now()-Pt,typeof window>"u"?cn:Ct);const ct=lt(void 0),ut=lt(void 0);let P;const oe={},ie={},se={},Tt=new Set,Fe={},tt={},ge={},Ot={},N={};let Te=.3835;const dt={Juggernaut:{x:-10400,y:5200},Berserker:{x:-10400,y:3700},Chieftain:{x:-10400,y:2200},Raider:{x:10200,y:5200},Deadeye:{x:10200,y:2200},Pathfinder:{x:10200,y:3700},Occultist:{x:-1500,y:-9850},Elementalist:{x:0,y:-9850},Necromancer:{x:1500,y:-9850},Slayer:{x:1500,y:9800},Gladiator:{x:-1500,y:9800},Champion:{x:0,y:9800},Inquisitor:{x:-10400,y:-2200},Hierophant:{x:-10400,y:-3700},Guardian:{x:-10400,y:-5200},Assassin:{x:10200,y:-5200},Trickster:{x:10200,y:-3700},Saboteur:{x:10200,y:-2200},Ascendant:{x:-7800,y:7200}},ae={},un=async e=>{var n,a,c,u;if(!et)return;const t=await et.GetTree(e);P=JSON.parse(t),console.log("Loaded skill tree",P),P.imageZoomLevels&&(Te=P.imageZoomLevels[P.imageZoomLevels.length-1]),Object.keys(P.groups).forEach(l=>{var g;const r=P.groups[l],h=parseInt(l);oe[h]=r,(g=r.nodes)==null||g.forEach(E=>{const k=P.nodes[E];if(ie[parseInt(E)]=k,k.classStartIndex!==void 0){Fe[h]=k.classStartIndex;for(const b of[...k.out||[],...k.in||[]]){const p=P.nodes[b];p.skill&&p.ascendancyName===void 0&&(tt[k.classStartIndex]=[...tt[k.classStartIndex]||[],p.skill])}}k.ascendancyName!==void 0&&(se[h]=k.ascendancyName),k.isAscendancyStart&&(Tt.add(h),k.ascendancyName&&(ae[k.ascendancyName]={x:dt[k.ascendancyName].x-r.x,y:dt[k.ascendancyName].y-r.y}))})});for(const l of["keystoneInactive","notableInactive","normalInactive","masteryInactive"]){const r=(n=P.sprites[l])==null?void 0:n[Te];Object.keys((r==null?void 0:r.coords)||{}).forEach(h=>r&&(ge[h]=r))}for(const l of["keystoneActive","notableActive","normalActive","masteryActiveSelected"]){const r=(a=P.sprites[l])==null?void 0:a[Te];Object.keys(r.coords).forEach(h=>r&&(Ot[h]=r))}for(const l of["background","mastery","masteryConnected","ascendancyBackground","ascendancy","startNode","groupBackground","frame","jewel","line","jewelRadius"]){let r=(c=P.sprites[l])==null?void 0:c[Te];r||(r=(u=P.sprites[l])==null?void 0:u[Object.keys(P.sprites[l])[0]]),Object.keys((r==null?void 0:r.coords)||{}).forEach(h=>r&&(N[h]=r))}ct.set(P),ut.set(e)},Ye=(e,t,n,a,c)=>({x:(Math.abs(P.min_x)+e+n)/c,y:(Math.abs(P.min_y)+t+a)/c}),fn=(e,t,n)=>{const a=Math.PI/180*n,c=Math.cos(a),u=Math.sin(a),l=c*(t.x-e.x)+u*(t.y-e.y)+e.x,r=c*(t.y-e.y)-u*(t.x-e.x)+e.y;return{x:l,y:r}},yt=[0,30,45,60,90,120,135,150,180,210,225,240,270,300,315,330],pt=[0,10,20,30,40,45,50,60,70,80,90,100,110,120,130,135,140,150,160,170,180,190,200,210,220,225,230,240,250,260,270,280,290,300,310,315,320,330,340,350],nt=(e,t)=>{var a;const n=(a=P.constants.skillsPerOrbit)==null?void 0:a[e];return n==16?yt[yt.length-t]||0:n==40?pt[pt.length-t]||0:360-360/(n||1)*t},Oe={},Qe=(e,t,n,a)=>{var c,u;if(e.group===void 0||e.orbit===void 0||e.orbitIndex===void 0||e.skill===void 0||!P.groups||!P.constants.orbitRadii)return{x:0,y:0};if(!(e.skill in Oe)){const l=P.groups[e.group],r=(e.ascendancyName&&((c=ae[e.ascendancyName])==null?void 0:c.x)||0)+l.x,h=(e.ascendancyName&&((u=ae[e.ascendancyName])==null?void 0:u.y)||0)+l.y,g=nt(e.orbit,e.orbitIndex);Oe[e.skill]=fn({x:r,y:h},{x:r,y:h-P.constants.orbitRadii[e.orbit]},g)}return Ye(Oe[e.skill].x,Oe[e.skill].y,t,n,a)},hn=(e,t)=>Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)),{window:xe}=Jt;function mt(e){let t,n,a,c;n=new an({props:{width:e[0],height:e[1],$$slots:{default:[dn]},$$scope:{ctx:e}}}),n.$on("pointerdown",e[6]),n.$on("wheel",e[9]);const u=e[26].default,l=bt(u,e,e[28],null);return{c(){t=we("div"),it(n.$$.fragment),a=vt(),l&&l.c(),this.h()},l(r){t=_e(r,"DIV",{style:!0});var h=be(t);at(n.$$.fragment,h),a=It(h),l&&l.l(h),h.forEach(z),this.h()},h(){W(t,"touch-action","none"),W(t,"cursor",e[2])},m(r,h){re(r,t,h),rt(n,t,null),Ut(t,a),l&&l.m(t,null),c=!0},p(r,h){const g={};h[0]&1&&(g.width=r[0]),h[0]&2&&(g.height=r[1]),h[0]&268435472&&(g.$$scope={dirty:h,ctx:r}),n.$set(g),l&&l.p&&(!c||h[0]&268435456)&&kt(l,u,r,r[28],c?Lt(u,r[28],h,null):St(r[28]),null),(!c||h[0]&4)&&W(t,"cursor",r[2])},i(r){c||(U(n.$$.fragment,r),U(l,r),c=!0)},o(r){ee(n.$$.fragment,r),ee(l,r),c=!1},d(r){r&&z(t),ot(n),l&&l.d(r)}}}function dn(e){let t,n;return t=new ln({props:{render:e[4]}}),{c(){it(t.$$.fragment)},l(a){at(t.$$.fragment,a)},m(a,c){rt(t,a,c),n=!0},p(a,c){const u={};c[0]&16&&(u.render=a[4]),t.$set(u)},i(a){n||(U(t.$$.fragment,a),n=!0)},o(a){ee(t.$$.fragment,a),n=!1},d(a){ot(t,a)}}}function yn(e){let t,n,a,c,u=e[0]&&e[1]&&mt(e);return{c(){t=we("div"),u&&u.c(),this.h()},l(l){t=_e(l,"DIV",{class:!0});var r=be(t);u&&u.l(r),r.forEach(z),this.h()},h(){V(t,"class","w-full h-full max-w-full max-h-full overflow-hidden")},m(l,r){re(l,t,r),u&&u.m(t,null),e[27](t),n=!0,a||(c=[f(xe,"pointerup",e[7]),f(xe,"pointermove",e[8]),f(xe,"resize",e[10])],a=!0)},p(l,r){l[0]&&l[1]?u?(u.p(l,r),r[0]&3&&U(u,1)):(u=mt(l),u.c(),U(u,1),u.m(t,null)):u&&(At(),ee(u,1,1,()=>{u=null}),Mt())},i(l){n||(U(u),n=!0)},o(l){ee(u),n=!1},d(l){l&&z(t),u&&u.d(),e[27](null),a=!1,Et(c)}}}const gt="25px Roboto Flex",wt="17px Roboto Flex",De=2.6;function pn(e,t,n){let a,c,u,l,r,h,g;fe(e,ct,i=>n(22,l=i)),fe(e,ut,i=>n(23,r=i)),fe(e,Wt,i=>n(25,g=i));let{$$slots:E={},$$scope:k}=t,b,p,{clickNode:v=console.log}=t,w=10,m=0,F=0;const H={},te={},I=(i,J,Z,Q,G=!1,B=!1,ne=!1)=>{const R=Q[J];if(!R)return;const o=R.filename;if(!(o in H)){const L=new URL(o).pathname,j=L.substring(L.lastIndexOf("/")+1),M=c+j;H[o]=new Image,H[o].src=M}const d=R.coords[J],S=d.w/w*De,_=d.h/w*De,O=Z.x-S/2,A=Z.y-_/2;let q=A;if(G&&(q=A-_/2),B&&H[o].complete){const L=o+":"+J;if(!(L in te)||!(ne in te[L])){const j=document.createElement("canvas"),M=j.getContext("2d");j.width=d.w,j.height=d.h,M.save(),M.beginPath(),M.arc(d.w/2,d.h/2,d.w/2,0,Math.PI*2,!0),M.closePath(),M.clip(),ne||(M.filter="brightness(50%) opacity(50%)"),M.drawImage(H[o],d.x,d.y,d.w,d.h,0,0,d.w,d.h),L in te||(te[L]={}),te[L][ne]=j}i.drawImage(te[L][ne],0,0,d.w,d.h,O,q,S,_)}else i.drawImage(H[o],d.x,d.y,d.w,d.h,O,q,S,_);G&&(i.save(),i.translate(O,A),i.rotate(Math.PI),i.drawImage(H[o],d.x,d.y,d.w,d.h,-S,-(_/2),S,-_),i.restore())},je=(i,J,Z)=>{const Q=[];let G="";return i.split(" ").forEach(B=>{J.measureText(G+B).width<Z?G+=" "+B:(Q.push(G.trim()),G=B)}),G.length>0&&Q.push(G.trim()),Q};let D={x:Number.MIN_VALUE,y:Number.MIN_VALUE},he="unset";const le=lt([]);fe(e,le,i=>n(24,h=i));const Y={};let X,ve=0,Ie=0,ke=0,Se=0,de=!1;const Be=i=>{de=!0,ve=i.offsetX,Ie=i.offsetY,ke=m,Se=F,n(17,D={x:i.offsetX,y:i.offsetY}),X&&v(X)},ze=i=>{i.type==="pointerup"&&(de=!1),n(17,D={x:i.offsetX,y:i.offsetY})},Je=i=>{de&&(n(15,m=ke-(ve-i.offsetX)*w),n(16,F=Se-(Ie-i.offsetY)*w)),n(17,D={x:i.offsetX,y:i.offsetY})},Ue=i=>{i.deltaY>0?w<30&&(n(15,m+=i.offsetX),n(16,F+=i.offsetY)):w>3&&(n(15,m-=i.offsetX),n(16,F-=i.offsetY)),n(14,w=Math.min(30,Math.max(3,w+i.deltaY/100))),i.preventDefault(),i.stopPropagation(),i.stopImmediatePropagation()};let K,Le=0,Ee=0;const ce=()=>{K&&(n(0,Le=K.offsetWidth),n(1,Ee=K.offsetHeight))};let ye=!1;st(()=>{new ResizeObserver(ce).observe(K),ce()});function Ve(i){$e[i?"unshift":"push"](()=>{K=i,n(3,K)})}return e.$$set=i=>{"clickNode"in i&&n(11,v=i.clickNode),"$$scope"in i&&n(28,k=i.$$scope)},e.$$.update=()=>{e.$$.dirty[0]&33554432&&(g==null||g.Build.ClassName.then(i=>n(12,b=i))),e.$$.dirty[0]&33554432&&(g==null||g.Build.AscendClassName.then(i=>n(13,p=i))),e.$$.dirty[0]&8388608&&n(21,a=`https://go-pob-data.pages.dev/data/${(r||"3_18").replace("_",".")}`),e.$$.dirty[0]&2097152&&(c=a+"/tree/assets/"),e.$$.dirty[0]&5259264&&(!ye&&l&&(n(20,ye=!0),n(15,m=l.min_x+window.innerWidth/2*w),n(16,F=l.min_y+window.innerHeight/2*w)),ce()),e.$$.dirty[0]&32501760&&n(4,u=({context:i,width:J,height:Z})=>{const Q=window.performance.now();if(i.clearRect(0,0,J,Z),i.fillStyle="#080c11",i.fillRect(0,0,J,Z),b){const R=l.classes.findIndex(o=>o.name===b);if(R in l.extraImages){const o=l.extraImages[R];if(o.image in Y||(n(18,Y[o.image]=new Image,Y),n(18,Y[o.image].src=a+"/raw/"+o.image,Y)),Y[o.image].complete){const d=Y[o.image].width/w*De*.5,S=Y[o.image].height/w*De*.5,_=Ye(o.x,o.y,m,F,w);i.drawImage(Y[o.image],0,0,Y[o.image].width,Y[o.image].height,_.x,_.y,d,S)}}}const G={};Object.keys(oe).forEach(R=>{var q,L;const o=parseInt(R),d=oe[R],S=(o in se&&((q=ae[se[o]])==null?void 0:q.x)||0)+d.x,_=(o in se&&((L=ae[se[o]])==null?void 0:L.y)||0)+d.y,O=Ye(S,_,m,F,w),A=Math.max(...d.orbits);o in Fe?b===l.classes[Fe[o]].name?I(i,"center"+l.classes[Fe[o]].name.toLowerCase(),O,N):I(i,"PSStartNodeBackgroundInactive",O,N,!1,!0):o in se?Tt.has(o)&&I(i,"Classes"+se[o],O,N,!1,!0,p===se[o]):A==1?I(i,"PSGroupBackground1",O,N):A==2?I(i,"PSGroupBackground2",O,N):(A==3||d.orbits.length>1)&&I(i,"PSGroupBackground3",O,N,!0)}),Object.keys(ie).forEach(R=>{var O;const o=ie[R],d=nt(o.orbit,o.orbitIndex),S=Qe(o,m,F,w);if(o.classStartIndex!==void 0)return;const _=h.indexOf(o.skill)>=0;(O=o.out)==null||O.forEach(A=>{var Ae,Me;if(!ie[parseInt(A)])return;const q=Math.min(parseInt(A),parseInt(R)),L=Math.max(parseInt(A),parseInt(R)),j=q+":"+L;if(j in G)return;G[j]=!0;const M=ie[parseInt(A)];if(M.isMastery||o.ascendancyName!==M.ascendancyName||M.classStartIndex!==void 0)return;const pe=nt(M.orbit,M.orbitIndex),Re=Qe(M,m,F,w);if(i.beginPath(),o.group!=M.group||o.orbit!=M.orbit)i.moveTo(S.x,S.y),i.lineTo(Re.x,Re.y);else{let x=Math.PI/180-Math.PI/180*d,$=Math.PI/180-Math.PI/180*pe;x-=Math.PI/2,$-=Math.PI/2;const Ne=Math.abs(Math.max(x,$)-Math.min(x,$)),We=Ne>Math.PI?Math.max(x,$):Math.min(x,$),He=Ne>Math.PI?Math.min(x,$):Math.max(x,$),Pe=oe[o.group],s=(o.ascendancyName&&((Ae=ae[o.ascendancyName])==null?void 0:Ae.x)||0)+Pe.x,me=(o.ascendancyName&&((Me=ae[o.ascendancyName])==null?void 0:Me.y)||0)+Pe.y,ue=Ye(s,me,m,F,w);i.arc(ue.x,ue.y,l.constants.orbitRadii[o.orbit]/w+1,We,He)}_&&h.indexOf(M.skill)>=0?i.strokeStyle="#c89c01":i.strokeStyle="#524518",i.lineWidth=6/w,i.stroke()})});let B;if(Object.keys(ie).forEach(R=>{const o=ie[R],d=Qe(o,m,F,w);let S=0;o.classStartIndex!==void 0||o.isAscendancyStart||(o.isKeystone?S=110:o.isNotable||o.isJewelSocket?S=70:o.isMastery?S=85:S=50),hn(d,D)<S/w&&(B=o);const _=h.indexOf(o.skill)>=0||B===o;o.classStartIndex!==void 0||(o.isAscendancyStart?I(i,"AscendancyMiddle",d,N):o.isKeystone?(I(i,o.icon,d,ge),_?I(i,"KeystoneFrameAllocated",d,N):I(i,"KeystoneFrameUnallocated",d,N)):o.isNotable?(I(i,o.icon,d,ge),o.ascendancyName?_?I(i,"AscendancyFrameLargeAllocated",d,N):I(i,"AscendancyFrameLargeNormal",d,N):_?I(i,"NotableFrameAllocated",d,N):I(i,"NotableFrameUnallocated",d,N)):o.isJewelSocket?o.expansionJewel?_?I(i,"JewelSocketAltActive",d,N):I(i,"JewelSocketAltNormal",d,N):_?I(i,"JewelFrameAllocated",d,N):I(i,"JewelFrameUnallocated",d,N):o.isMastery?_?I(i,o.activeIcon,d,Ot):I(i,o.inactiveIcon,d,ge):(I(i,o.icon,d,ge),o.ascendancyName?_?I(i,"AscendancyFrameSmallAllocated",d,N):I(i,"AscendancyFrameSmallNormal",d,N):_?I(i,"PSSkillFrameActive",d,N):I(i,"PSSkillFrame",d,N)))}),X!=B)if(n(19,X=B),X!==void 0&&b){const R=tt[l.classes.findIndex(d=>d.name===b)],o=X.skill;et.CalculateTreePath(r||"3_18",R,o).then(d=>{le.set(d)})}else le.set([]);if(X){const R=X.name,o=(X.stats||[]).map(L=>({text:L,special:!1}));i.font=gt;const d=i.measureText(R),S=Math.max(d.width+50,600);i.font=wt;const _=[],O=30;let A=85;o&&o.length>0?o.forEach(L=>{_.length>0&&(A+=5),L.text.split(`
`).forEach(j=>{_.length>0&&(A+=10),je(j,i,S-O).forEach(pe=>{_.push({text:pe,offset:A,special:L.special}),A+=20})})}):X.isJewelSocket&&(_.push({text:"Click to select this socket",offset:A,special:!0}),A+=20);const q=55;i.fillStyle="rgba(75,63,24,0.9)",i.fillRect(D.x,D.y,S,q),i.fillStyle="#ffffff",i.font=gt,i.textAlign="center",i.fillText(R,D.x+S/2,D.y+35),i.fillStyle="rgba(0,0,0,0.8)",i.fillRect(D.x,D.y+q,S,A-q),i.font=wt,i.textAlign="left",_.forEach(L=>{L.special?i.fillStyle="#8cf34c":i.fillStyle="#ffffff",i.fillText(L.text,D.x+O/2,D.y+L.offset)})}X?n(2,he="pointer"):n(2,he="unset"),i.fillStyle="#ffffff",i.textAlign="right",i.font="12px Roboto Mono";const ne=window.performance.now();i.fillText(`${(ne-Q).toFixed(1)}ms`,J-5,17)})},[Le,Ee,he,K,u,le,Be,ze,Je,Ue,ce,v,b,p,w,m,F,D,Y,X,ye,a,l,r,h,g,E,Ve,k]}class mn extends Xe{constructor(t){super(),Ge(this,t,pn,yn,qe,{clickNode:11},null,[-1,-1])}}function _t(e){let t,n;return t=new mn({}),{c(){it(t.$$.fragment)},l(a){at(t.$$.fragment,a)},m(a,c){rt(t,a,c),n=!0},i(a){n||(U(t.$$.fragment,a),n=!0)},o(a){ee(t.$$.fragment,a),n=!1},d(a){ot(t,a)}}}function gn(e){let t=e[1]&&e[0]&&Object.keys(oe).length>0,n,a,c=t&&_t();return{c(){c&&c.c(),n=ft()},l(u){c&&c.l(u),n=ft()},m(u,l){c&&c.m(u,l),re(u,n,l),a=!0},p(u,[l]){l&3&&(t=u[1]&&u[0]&&Object.keys(oe).length>0),t?c?l&3&&U(c,1):(c=_t(),c.c(),U(c,1),c.m(n.parentNode,n)):c&&(At(),ee(c,1,1,()=>{c=null}),Mt())},i(u){a||(U(c),a=!0)},o(u){ee(c),a=!1},d(u){c&&c.d(u),u&&z(n)}}}function wn(e,t,n){let a,c;return fe(e,ut,u=>n(0,a=u)),fe(e,ct,u=>n(1,c=u)),st(()=>{(!c||!a||Object.keys(oe).length===0)&&un("3_18")}),[a,c]}class kn extends Xe{constructor(t){super(),Ge(this,t,wn,gn,qe,{})}}export{kn as default};

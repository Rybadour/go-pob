import{ac as dt,E as ae,ad as ht,S as de,i as he,s as pe,T as We,k as ee,a as Je,l as te,m as se,h as T,c as He,n as j,p as le,b as J,ae as pt,U as Ke,V as Ze,W as Qe,f as O,t as D,af as mt,o as Me,aa as xe,R as _e,A as we,ag as gt,g as $e,d as et,F as wt,G as ce,Y as yt,v as ve,w as Pe,x as Re,B as bt,y as Ee,e as ze}from"../../../chunks/index-1df78059.js";import{r as _t,w as tt}from"../../../chunks/index-c295fc78.js";import{s as Ge}from"../../../chunks/worker-609995b1.js";const kt=["focus","blur","fullscreenchange","fullscreenerror","scroll","cut","copy","paste","keydown","keypress","keyup","auxclick","click","contextmenu","dblclick","mousedown","mouseenter","mouseleave","mousemove","mouseover","mouseout","mouseup","pointerlockchange","pointerlockerror","select","wheel","drag","dragend","dragenter","dragstart","dragleave","dragover","drop","touchcancel","touchend","touchmove","touchstart","pointerover","pointerenter","pointerdown","pointermove","pointerup","pointercancel","pointerout","pointerleave","gotpointercapture","lostpointercapture"];function It(){const s=dt();return e=>{const t=kt.map(n=>ae(e,n,l=>ht(s,l)));return{destroy:()=>t.forEach(n=>n())}}}class St{constructor(){this.register=this.register.bind(this),this.unregister=this.unregister.bind(this),this.redraw=this.redraw.bind(this),this.resize=this.resize.bind(this),this.render=this.render.bind(this),this.currentLayerId=0,this.setups=new Map,this.renderers=new Map,this.needsSetup=!1,this.needsResize=!0,this.needsRedraw=!0,this.layerSequence=[]}redraw(){this.needsRedraw=!0}resize(){this.needsResize=!0,this.needsRedraw=!0}register({setup:e,render:t}){return e&&(this.setups.set(this.currentLayerId,e),this.needsSetup=!0),this.renderers.set(this.currentLayerId,t),this.needsRedraw=!0,this.currentLayerId++}unregister(e){this.renderers.delete(e),this.needsRedraw=!0}render({autoclear:e,pixelRatio:t,context:n,width:l,height:a}){const i={context:n,width:l,height:a};if(this.needsResize&&(n.setTransform(t,0,0,t,0,0),this.needsResize=!1),this.needsSetup){for(const[o,c]of this.setups)c(i),this.setups.delete(o);this.needsSetup=!1}if(this.needsRedraw){e&&n.clearRect(0,0,l,a);for(const o of this.layerSequence)this.renderers.get(o)(i);this.needsRedraw=!1}}}function Mt(s){let e,t,n,l,a,i,o,c,y;const p=s[13].default,d=We(p,s,s[12],null);return{c(){e=ee("canvas"),a=Je(),i=ee("div"),d&&d.c(),this.h()},l(f){e=te(f,"CANVAS",{style:!0,width:!0,height:!0}),se(e).forEach(T),a=He(f),i=te(f,"DIV",{style:!0});var g=se(i);d&&d.l(g),g.forEach(T),this.h()},h(){j(e,"style",t="display: block; width: "+s[1]+"px; height: "+s[2]+"px;"+(s[3]?` ${s[3]}`:"")),j(e,"width",n=s[1]*s[0]),j(e,"height",l=s[2]*s[0]),le(i,"display","none")},m(f,g){J(f,e,g),s[14](e),J(f,a,g),J(f,i,g),d&&d.m(i,null),s[15](i),o=!0,c||(y=pt(s[6].call(null,e)),c=!0)},p(f,[g]){(!o||g&14&&t!==(t="display: block; width: "+f[1]+"px; height: "+f[2]+"px;"+(f[3]?` ${f[3]}`:"")))&&j(e,"style",t),(!o||g&3&&n!==(n=f[1]*f[0]))&&j(e,"width",n),(!o||g&5&&l!==(l=f[2]*f[0]))&&j(e,"height",l),d&&d.p&&(!o||g&4096)&&Ke(d,p,f,f[12],o?Qe(p,f[12],g,null):Ze(f[12]),null)},i(f){o||(O(d,f),o=!0)},o(f){D(d,f),o=!1},d(f){f&&T(e),s[14](null),f&&T(a),f&&T(i),d&&d.d(f),s[15](null),c=!1,y()}}}const st={};function vt(s,e,t){let{$$slots:n={},$$scope:l}=e,{width:a=640,height:i=640,pixelRatio:o=void 0,style:c=null,autoclear:y=!0}=e,p,d,f,g,V;const k=It(),A=new St;function S(){A.redraw()}function K(){return p}function L(){return d}o===void 0&&(typeof window>"u"?o=2:o=window.devicePixelRatio);function Z(){A.render({context:d,width:a,height:i,pixelRatio:o,autoclear:y}),f=window.requestAnimationFrame(Z)}mt(st,{register:A.register,unregister:A.unregister,redraw:A.redraw}),Me(()=>{d=p.getContext("2d"),V=new MutationObserver(w),V.observe(g,{childList:!0}),w(),Z();function w(){const Q=[...g.children].map(me=>+me.dataset.layerId);t(11,A.layerSequence=Q,A),A.redraw()}}),xe(()=>{typeof window>"u"||(window.cancelAnimationFrame(f),V.disconnect())});function re(w){_e[w?"unshift":"push"](()=>{p=w,t(4,p)})}function ne(w){_e[w?"unshift":"push"](()=>{g=w,t(5,g)})}return s.$$set=w=>{"width"in w&&t(1,a=w.width),"height"in w&&t(2,i=w.height),"pixelRatio"in w&&t(0,o=w.pixelRatio),"style"in w&&t(3,c=w.style),"autoclear"in w&&t(7,y=w.autoclear),"$$scope"in w&&t(12,l=w.$$scope)},s.$$.update=()=>{s.$$.dirty&2183&&A.resize()},[o,a,i,c,p,g,k,y,S,K,L,A,l,n,re,ne]}class Pt extends de{constructor(e){super(),he(this,e,vt,Mt,pe,{width:1,height:2,pixelRatio:0,style:3,autoclear:7,redraw:8,getCanvas:9,getContext:10})}get redraw(){return this.$$.ctx[8]}get getCanvas(){return this.$$.ctx[9]}get getContext(){return this.$$.ctx[10]}}function Rt(s){let e;return{c(){e=ee("div"),this.h()},l(t){e=te(t,"DIV",{"data-layer-id":!0}),se(e).forEach(T),this.h()},h(){j(e,"data-layer-id",s[0])},m(t,n){J(t,e,n)},p:we,i:we,o:we,d(t){t&&T(e)}}}function Et(s,e,t){const{register:n,unregister:l,redraw:a}=gt(st);let{setup:i=void 0,render:o=()=>{}}=e;if(typeof i!="function"&&i!==void 0)throw new Error("setup must be a function");if(typeof o!="function")throw new Error("render must be a function");const c=n({setup:i,render:o});return xe(()=>l(c)),s.$$set=y=>{"setup"in y&&t(1,i=y.setup),"render"in y&&t(2,o=y.render)},s.$$.update=()=>{s.$$.dirty&4&&a()},[c,i,o]}class At extends de{constructor(e){super(),he(this,e,Et,Rt,pe,{setup:1,render:2})}}let De;const rt=Date.now();function nt(s){return s(Date.now()-rt),De=window.requestAnimationFrame(()=>nt(s)),()=>window.cancelAnimationFrame(De)}function Nt(){}_t(Date.now()-rt,typeof window>"u"?Nt:nt);const Ae=tt(void 0),Ne=tt(void 0);let _;const fe={},W={},ke={},ot=new Set,Ie={},$={},C={};let ie=.3835;const Ct=async s=>{var t,n,l,a;if(!Ge)return;const e=await Ge.GetTree(s);_=JSON.parse(e),console.log("Loaded skill tree",_),_.imageZoomLevels&&(ie=_.imageZoomLevels[_.imageZoomLevels.length-1]),Object.keys(_.groups).forEach(i=>{var y;const o=_.groups[i],c=parseInt(i);fe[c]=o,(y=o.nodes)==null||y.forEach(p=>{const d=_.nodes[p];W[parseInt(p)]=d,d.classStartIndex!==void 0&&(Ie[c]=d.classStartIndex),d.ascendancyName!==void 0&&(ke[c]=d.ascendancyName),d.isAscendancyStart&&ot.add(c)})});for(const i of["keystoneInactive","notableInactive","normalInactive","masteryInactive"]){const o=(t=_.sprites[i])==null?void 0:t[ie];Object.keys((o==null?void 0:o.coords)||{}).forEach(c=>o&&($[c]=o))}for(const i of["keystoneActive","notableActive","normalActive","masteryActiveSelected"]){const o=(n=_.sprites[i])==null?void 0:n[ie];Object.keys(o.coords).forEach(c=>o&&o)}for(const i of["background","mastery","masteryConnected","ascendancyBackground","ascendancy","startNode","groupBackground","frame","jewel","line","jewelRadius"]){let o=(l=_.sprites[i])==null?void 0:l[ie];o||(o=(a=_.sprites[i])==null?void 0:a[Object.keys(_.sprites[i])[0]]),Object.keys((o==null?void 0:o.coords)||{}).forEach(c=>o&&(C[c]=o))}Ae.set(_),Ne.set(s)},ue=(s,e,t,n,l)=>({x:(Math.abs(_.min_x)+s+t)/l,y:(Math.abs(_.min_y)+e+n)/l}),Tt=(s,e,t)=>{const n=Math.PI/180*t,l=Math.cos(n),a=Math.sin(n),i=l*(e.x-s.x)+a*(e.y-s.y)+s.x,o=l*(e.y-s.y)-a*(e.x-s.x)+s.y;return{x:i,y:o}},Fe=[0,30,45,60,90,120,135,150,180,210,225,240,270,300,315,330],je=[0,10,20,30,40,45,50,60,70,80,90,100,110,120,130,135,140,150,160,170,180,190,200,210,220,225,230,240,250,260,270,280,290,300,310,315,320,330,340,350],Se=(s,e)=>{var n;const t=(n=_.constants.skillsPerOrbit)==null?void 0:n[s];return t==16?Fe[Fe.length-e]||0:t==40?je[je.length-e]||0:360-360/(t||1)*e},ye=(s,e,t,n)=>{if(s.group===void 0||s.orbit===void 0||s.orbitIndex===void 0||!_.groups||!_.constants.orbitRadii)return{x:0,y:0};const l=_.groups[s.group],a=Se(s.orbit,s.orbitIndex),i=ue(l.x,l.y,e,t,n),o=ue(l.x,l.y-_.constants.orbitRadii[s.orbit],e,t,n);return Tt(i,o,a)},Lt=(s,e)=>Math.sqrt(Math.pow(s.x-e.x,2)+Math.pow(s.y-e.y,2)),{window:be}=yt;function Ve(s){let e,t,n,l;t=new Pt({props:{width:s[0],height:s[1],$$slots:{default:[Ot]},$$scope:{ctx:s}}}),t.$on("pointerdown",s[5]),t.$on("wheel",s[8]);const a=s[19].default,i=We(a,s,s[21],null);return{c(){e=ee("div"),ve(t.$$.fragment),n=Je(),i&&i.c(),this.h()},l(o){e=te(o,"DIV",{style:!0});var c=se(e);Pe(t.$$.fragment,c),n=He(c),i&&i.l(c),c.forEach(T),this.h()},h(){le(e,"touch-action","none"),le(e,"cursor",s[2])},m(o,c){J(o,e,c),Re(t,e,null),bt(e,n),i&&i.m(e,null),l=!0},p(o,c){const y={};c[0]&1&&(y.width=o[0]),c[0]&2&&(y.height=o[1]),c[0]&2097168&&(y.$$scope={dirty:c,ctx:o}),t.$set(y),i&&i.p&&(!l||c[0]&2097152)&&Ke(i,a,o,o[21],l?Qe(a,o[21],c,null):Ze(o[21]),null),(!l||c[0]&4)&&le(e,"cursor",o[2])},i(o){l||(O(t.$$.fragment,o),O(i,o),l=!0)},o(o){D(t.$$.fragment,o),D(i,o),l=!1},d(o){o&&T(e),Ee(t),i&&i.d(o)}}}function Ot(s){let e,t;return e=new At({props:{render:s[4]}}),{c(){ve(e.$$.fragment)},l(n){Pe(e.$$.fragment,n)},m(n,l){Re(e,n,l),t=!0},p(n,l){const a={};l[0]&16&&(a.render=n[4]),e.$set(a)},i(n){t||(O(e.$$.fragment,n),t=!0)},o(n){D(e.$$.fragment,n),t=!1},d(n){Ee(e,n)}}}function Yt(s){let e,t,n,l,a=s[0]&&s[1]&&Ve(s);return{c(){e=ee("div"),a&&a.c(),this.h()},l(i){e=te(i,"DIV",{class:!0});var o=se(e);a&&a.l(o),o.forEach(T),this.h()},h(){j(e,"class","w-full h-full max-w-full max-h-full overflow-hidden")},m(i,o){J(i,e,o),a&&a.m(e,null),s[20](e),t=!0,n||(l=[ae(be,"pointerup",s[6]),ae(be,"pointermove",s[7]),ae(be,"resize",s[9])],n=!0)},p(i,o){i[0]&&i[1]?a?(a.p(i,o),o[0]&3&&O(a,1)):(a=Ve(i),a.c(),O(a,1),a.m(e,null)):a&&($e(),D(a,1,1,()=>{a=null}),et())},i(i){t||(O(a),t=!0)},o(i){D(a),t=!1},d(i){i&&T(e),a&&a.d(),s[20](null),n=!1,wt(l)}}}const Ue="25px Roboto Mono",Xe="17px Roboto Mono",qe=2.6;function zt(s,e,t){let n,l,a,i;ce(s,Ae,r=>t(17,a=r)),ce(s,Ne,r=>t(18,i=r));let{$$slots:o={},$$scope:c}=e,{clickNode:y=console.log}=e,p=10,d=0,f=0;const g={},V={},k=(r,Y,X,q,N=!1,F=!1)=>{const x=q[Y];if(!x)return;const R=x.filename,h=new URL(R).pathname,b=h.substring(h.lastIndexOf("/")+1),m=n+b;m in g||(g[m]=new Image,g[m].src=m);const u=x.coords[Y],E=u.w/p*qe,I=u.h/p*qe,z=X.x-E/2,M=X.y-I/2;let v=M;if(N&&(v=M-I/2),F&&g[m].complete){const H=m+":"+Y;if(!(H in V)){const G=document.createElement("canvas"),P=G.getContext("2d");G.width=u.w,G.height=u.h,P.save(),P.beginPath(),P.arc(u.w/2,u.h/2,u.w/2,0,Math.PI*2,!0),P.closePath(),P.clip(),P.drawImage(g[m],u.x,u.y,u.w,u.h,0,0,u.w,u.h),V[H]=G}r.drawImage(V[H],0,0,u.w,u.h,z,v,E,I)}else r.drawImage(g[m],u.x,u.y,u.w,u.h,z,v,E,I);N&&(r.save(),r.translate(z,M),r.rotate(Math.PI),r.drawImage(g[m],u.x,u.y,u.w,u.h,-E,-(I/2),E,-I),r.restore())},A=(r,Y,X)=>{const q=[];let N="";return r.split(" ").forEach(F=>{Y.measureText(N+F).width<X?N+=" "+F:(q.push(N.trim()),N=F)}),N.length>0&&q.push(N.trim()),q};let S={x:Number.MIN_VALUE,y:Number.MIN_VALUE},K="unset",L,Z=0,re=0,ne=0,w=0,Q=!1;const me=r=>{Q=!0,Z=r.offsetX,re=r.offsetY,ne=d,w=f,t(14,S={x:r.offsetX,y:r.offsetY}),L&&y(L)},it=r=>{r.type==="pointerup"&&(Q=!1),t(14,S={x:r.offsetX,y:r.offsetY})},at=r=>{Q&&(t(12,d=ne-(Z-r.offsetX)*p),t(13,f=w-(re-r.offsetY)*p)),t(14,S={x:r.offsetX,y:r.offsetY})},lt=r=>{r.deltaY>0?p<30&&(t(12,d+=r.offsetX),t(13,f+=r.offsetY)):p>3&&(t(12,d-=r.offsetX),t(13,f-=r.offsetY)),t(11,p=Math.min(30,Math.max(3,p+r.deltaY/100))),r.preventDefault(),r.stopPropagation(),r.stopImmediatePropagation()};let U,Ce=0,Te=0;const oe=()=>{U&&(t(0,Ce=U.offsetWidth),t(1,Te=U.offsetHeight))};let ge=!1;Me(()=>{new ResizeObserver(oe).observe(U),oe()});function ft(r){_e[r?"unshift":"push"](()=>{U=r,t(3,U)})}return s.$$set=r=>{"clickNode"in r&&t(10,y=r.clickNode),"$$scope"in r&&t(21,c=r.$$scope)},s.$$.update=()=>{s.$$.dirty[0]&262144&&(n=`https://go-pob-data.pages.dev/data/${i.replace("_",".")}/tree/assets/`),s.$$.dirty[0]&198656&&(!ge&&a&&(t(16,ge=!0),t(12,d=a.min_x+window.innerWidth/2*p),t(13,f=a.min_y+window.innerHeight/2*p)),oe()),s.$$.dirty[0]&194560&&t(4,l=({context:r,width:Y,height:X})=>{const q=window.performance.now();r.clearRect(0,0,Y,X),r.fillStyle="#080c11",r.fillRect(0,0,Y,X);const N={};Object.keys(fe).forEach(R=>{const h=fe[R],b=ue(h.x,h.y,d,f,p),m=Math.max(...h.orbits),u=parseInt(R);u in Ie?k(r,"center"+a.classes[Ie[u]].name.toLowerCase(),b,C):u in ke?ot.has(u)&&k(r,"Classes"+ke[u],b,C,!1,!0):m==1?k(r,"PSGroupBackground1",b,C):m==2?k(r,"PSGroupBackground2",b,C):(m==3||h.orbits.length>1)&&k(r,"PSGroupBackground3",b,C,!0)}),Object.keys(W).forEach(R=>{var u;const h=W[R],b=Se(h.orbit,h.orbitIndex),m=ye(h,d,f,p);h.classStartIndex===void 0&&((u=h.out)==null||u.forEach(E=>{if(!W[parseInt(E)])return;const I=Math.min(parseInt(E),parseInt(R)),z=Math.max(parseInt(E),parseInt(R)),M=I+":"+z;if(M in N)return;N[M]=!0;const v=W[parseInt(E)];if(!v||v.isMastery||h.ascendancyName!==v.ascendancyName||v.classStartIndex!==void 0)return;const H=Se(v.orbit,v.orbitIndex),G=ye(v,d,f,p);if(r.beginPath(),h.group!=v.group||h.orbit!=v.orbit)r.moveTo(m.x,m.y),r.lineTo(G.x,G.y);else{let P=Math.PI/180-Math.PI/180*b,B=Math.PI/180-Math.PI/180*H;P-=Math.PI/2,B-=Math.PI/2;const Le=Math.abs(Math.max(P,B)-Math.min(P,B)),ct=Le>Math.PI?Math.max(P,B):Math.min(P,B),ut=Le>Math.PI?Math.min(P,B):Math.max(P,B),Oe=fe[h.group],Ye=ue(Oe.x,Oe.y,d,f,p);r.arc(Ye.x,Ye.y,a.constants.orbitRadii[h.orbit]/p+1,ct,ut)}r.lineWidth=6/p,r.strokeStyle="#524518",r.stroke()}))});let F;if(Object.keys(W).forEach(R=>{const h=W[R],b=ye(h,d,f,p);let m=0;h.classStartIndex!==void 0||(h.isAscendancyStart?k(r,"AscendancyMiddle",b,C):h.isKeystone?(m=110,k(r,h.icon,b,$),k(r,"KeystoneFrameUnallocated",b,C)):h.isNotable?(m=70,k(r,h.icon,b,$),k(r,"NotableFrameUnallocated",b,C)):h.isJewelSocket?(m=70,h.expansionJewel?k(r,"JewelSocketAltNormal",b,C):k(r,"JewelFrameUnallocated",b,C)):h.isMastery?k(r,h.inactiveIcon,b,$):(m=50,k(r,h.icon,b,$),k(r,"PSSkillFrame",b,C))),Lt(b,S)<m/p&&(F=h)}),t(15,L=F),L){const R=L.name,h=(L.stats||[]).map(M=>({text:M,special:!1}));r.font=Ue;const b=r.measureText(R),m=Math.max(b.width+50,600);r.font=Xe;const u=[],E=30;let I=85;h&&h.length>0?h.forEach(M=>{u.length>0&&(I+=5),M.text.split(`
`).forEach(v=>{u.length>0&&(I+=10),A(v,r,m-E).forEach(G=>{u.push({text:G,offset:I,special:M.special}),I+=20})})}):L.isJewelSocket&&(u.push({text:"Click to select this socket",offset:I,special:!0}),I+=20);const z=55;r.fillStyle="rgba(75,63,24,0.9)",r.fillRect(S.x,S.y,m,z),r.fillStyle="#ffffff",r.font=Ue,r.textAlign="center",r.fillText(R,S.x+m/2,S.y+35),r.fillStyle="rgba(0,0,0,0.8)",r.fillRect(S.x,S.y+z,m,I-z),r.font=Xe,r.textAlign="left",u.forEach(M=>{M.special?r.fillStyle="#8cf34c":r.fillStyle="#ffffff",r.fillText(M.text,S.x+E/2,S.y+M.offset)})}L?t(2,K="pointer"):t(2,K="unset"),r.fillStyle="#ffffff",r.textAlign="right",r.font="12px Roboto Mono";const x=window.performance.now();r.fillText(`${(x-q).toFixed(1)}ms`,Y-5,17)})},[Ce,Te,K,U,l,me,it,at,lt,oe,y,p,d,f,S,L,ge,a,i,o,ft,c]}class Gt extends de{constructor(e){super(),he(this,e,zt,Yt,pe,{clickNode:10},null,[-1,-1])}}function Be(s){let e,t;return e=new Gt({}),{c(){ve(e.$$.fragment)},l(n){Pe(e.$$.fragment,n)},m(n,l){Re(e,n,l),t=!0},i(n){t||(O(e.$$.fragment,n),t=!0)},o(n){D(e.$$.fragment,n),t=!1},d(n){Ee(e,n)}}}function Dt(s){let e,t,n=s[1]&&s[0]&&Be();return{c(){n&&n.c(),e=ze()},l(l){n&&n.l(l),e=ze()},m(l,a){n&&n.m(l,a),J(l,e,a),t=!0},p(l,[a]){l[1]&&l[0]?n?a&3&&O(n,1):(n=Be(),n.c(),O(n,1),n.m(e.parentNode,e)):n&&($e(),D(n,1,1,()=>{n=null}),et())},i(l){t||(O(n),t=!0)},o(l){D(n),t=!1},d(l){n&&n.d(l),l&&T(e)}}}function Ft(s,e,t){let n,l;return ce(s,Ne,a=>t(0,n=a)),ce(s,Ae,a=>t(1,l=a)),Me(()=>{(!l||!n)&&Ct("3_18")}),[n,l]}class Xt extends de{constructor(e){super(),he(this,e,Ft,Dt,pe,{})}}export{Xt as default};

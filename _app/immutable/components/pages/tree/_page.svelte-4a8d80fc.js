import{ac as ut,E as re,ad as dt,S as le,i as fe,s as ce,T as We,k as H,a as Je,l as K,m as Z,h as E,c as He,n as G,p as ne,b as q,ae as ht,U as Ke,V as Ze,W as Qe,f as C,t as Y,af as pt,o as Se,aa as xe,R as be,A as ge,ag as mt,g as $e,d as et,F as gt,G as ie,Y as wt,v as Me,w as Re,x as ve,B as yt,y as Pe,e as ze}from"../../../chunks/index-1df78059.js";import{r as bt,w as tt}from"../../../chunks/index-c295fc78.js";import{s as Ge}from"../../../chunks/worker-609995b1.js";const _t=["focus","blur","fullscreenchange","fullscreenerror","scroll","cut","copy","paste","keydown","keypress","keyup","auxclick","click","contextmenu","dblclick","mousedown","mouseenter","mouseleave","mousemove","mouseover","mouseout","mouseup","pointerlockchange","pointerlockerror","select","wheel","drag","dragend","dragenter","dragstart","dragleave","dragover","drop","touchcancel","touchend","touchmove","touchstart","pointerover","pointerenter","pointerdown","pointermove","pointerup","pointercancel","pointerout","pointerleave","gotpointercapture","lostpointercapture"];function kt(){const s=ut();return e=>{const t=_t.map(n=>re(e,n,l=>dt(s,l)));return{destroy:()=>t.forEach(n=>n())}}}class It{constructor(){this.register=this.register.bind(this),this.unregister=this.unregister.bind(this),this.redraw=this.redraw.bind(this),this.resize=this.resize.bind(this),this.render=this.render.bind(this),this.currentLayerId=0,this.setups=new Map,this.renderers=new Map,this.needsSetup=!1,this.needsResize=!0,this.needsRedraw=!0,this.layerSequence=[]}redraw(){this.needsRedraw=!0}resize(){this.needsResize=!0,this.needsRedraw=!0}register({setup:e,render:t}){return e&&(this.setups.set(this.currentLayerId,e),this.needsSetup=!0),this.renderers.set(this.currentLayerId,t),this.needsRedraw=!0,this.currentLayerId++}unregister(e){this.renderers.delete(e),this.needsRedraw=!0}render({autoclear:e,pixelRatio:t,context:n,width:l,height:a}){const i={context:n,width:l,height:a};if(this.needsResize&&(n.setTransform(t,0,0,t,0,0),this.needsResize=!1),this.needsSetup){for(const[o,c]of this.setups)c(i),this.setups.delete(o);this.needsSetup=!1}if(this.needsRedraw){e&&n.clearRect(0,0,l,a);for(const o of this.layerSequence)this.renderers.get(o)(i);this.needsRedraw=!1}}}function St(s){let e,t,n,l,a,i,o,c,b;const h=s[13].default,u=We(h,s,s[12],null);return{c(){e=H("canvas"),a=Je(),i=H("div"),u&&u.c(),this.h()},l(f){e=K(f,"CANVAS",{style:!0,width:!0,height:!0}),Z(e).forEach(E),a=He(f),i=K(f,"DIV",{style:!0});var w=Z(i);u&&u.l(w),w.forEach(E),this.h()},h(){G(e,"style",t="display: block; width: "+s[1]+"px; height: "+s[2]+"px;"+(s[3]?` ${s[3]}`:"")),G(e,"width",n=s[1]*s[0]),G(e,"height",l=s[2]*s[0]),ne(i,"display","none")},m(f,w){q(f,e,w),s[14](e),q(f,a,w),q(f,i,w),u&&u.m(i,null),s[15](i),o=!0,c||(b=ht(s[6].call(null,e)),c=!0)},p(f,[w]){(!o||w&14&&t!==(t="display: block; width: "+f[1]+"px; height: "+f[2]+"px;"+(f[3]?` ${f[3]}`:"")))&&G(e,"style",t),(!o||w&3&&n!==(n=f[1]*f[0]))&&G(e,"width",n),(!o||w&5&&l!==(l=f[2]*f[0]))&&G(e,"height",l),u&&u.p&&(!o||w&4096)&&Ke(u,h,f,f[12],o?Qe(h,f[12],w,null):Ze(f[12]),null)},i(f){o||(C(u,f),o=!0)},o(f){Y(u,f),o=!1},d(f){f&&E(e),s[14](null),f&&E(a),f&&E(i),u&&u.d(f),s[15](null),c=!1,b()}}}const st={};function Mt(s,e,t){let{$$slots:n={},$$scope:l}=e,{width:a=640,height:i=640,pixelRatio:o=void 0,style:c=null,autoclear:b=!0}=e,h,u,f,w,k;const ue=kt(),y=new It;function B(){y.redraw()}function N(){return h}function Q(){return u}o===void 0&&(typeof window>"u"?o=2:o=window.devicePixelRatio);function W(){y.render({context:u,width:a,height:i,pixelRatio:o,autoclear:b}),f=window.requestAnimationFrame(W)}pt(st,{register:y.register,unregister:y.unregister,redraw:y.redraw}),Se(()=>{u=h.getContext("2d"),k=new MutationObserver(g),k.observe(w,{childList:!0}),g(),W();function g(){const de=[...w.children].map(he=>+he.dataset.layerId);t(11,y.layerSequence=de,y),y.redraw()}}),xe(()=>{typeof window>"u"||(window.cancelAnimationFrame(f),k.disconnect())});function x(g){be[g?"unshift":"push"](()=>{h=g,t(4,h)})}function $(g){be[g?"unshift":"push"](()=>{w=g,t(5,w)})}return s.$$set=g=>{"width"in g&&t(1,a=g.width),"height"in g&&t(2,i=g.height),"pixelRatio"in g&&t(0,o=g.pixelRatio),"style"in g&&t(3,c=g.style),"autoclear"in g&&t(7,b=g.autoclear),"$$scope"in g&&t(12,l=g.$$scope)},s.$$.update=()=>{s.$$.dirty&2183&&y.resize()},[o,a,i,c,h,w,ue,b,B,N,Q,y,l,n,x,$]}class Rt extends le{constructor(e){super(),fe(this,e,Mt,St,ce,{width:1,height:2,pixelRatio:0,style:3,autoclear:7,redraw:8,getCanvas:9,getContext:10})}get redraw(){return this.$$.ctx[8]}get getCanvas(){return this.$$.ctx[9]}get getContext(){return this.$$.ctx[10]}}function vt(s){let e;return{c(){e=H("div"),this.h()},l(t){e=K(t,"DIV",{"data-layer-id":!0}),Z(e).forEach(E),this.h()},h(){G(e,"data-layer-id",s[0])},m(t,n){q(t,e,n)},p:ge,i:ge,o:ge,d(t){t&&E(e)}}}function Pt(s,e,t){const{register:n,unregister:l,redraw:a}=mt(st);let{setup:i=void 0,render:o=()=>{}}=e;if(typeof i!="function"&&i!==void 0)throw new Error("setup must be a function");if(typeof o!="function")throw new Error("render must be a function");const c=n({setup:i,render:o});return xe(()=>l(c)),s.$$set=b=>{"setup"in b&&t(1,i=b.setup),"render"in b&&t(2,o=b.render)},s.$$.update=()=>{s.$$.dirty&4&&a()},[c,i,o]}class At extends le{constructor(e){super(),fe(this,e,Pt,vt,ce,{setup:1,render:2})}}let De;const rt=Date.now();function nt(s){return s(Date.now()-rt),De=window.requestAnimationFrame(()=>nt(s)),()=>window.cancelAnimationFrame(De)}function Et(){}bt(Date.now()-rt,typeof window>"u"?Et:nt);const Ae=tt(void 0),Ee=tt(void 0);let _;const oe={},X={},_e={},ot=new Set,ke={},J={},A={};let se=.3835;const Nt=async s=>{var t,n,l,a;if(!Ge)return;const e=await Ge.GetTree(s);_=JSON.parse(e),console.log("Loaded skill tree",_),_.imageZoomLevels&&(se=_.imageZoomLevels[_.imageZoomLevels.length-1]),Object.keys(_.groups).forEach(i=>{var b;const o=_.groups[i],c=parseInt(i);oe[c]=o,(b=o.nodes)==null||b.forEach(h=>{const u=_.nodes[h];X[parseInt(h)]=u,u.classStartIndex!==void 0&&(ke[c]=u.classStartIndex),u.ascendancyName!==void 0&&(_e[c]=u.ascendancyName),u.isAscendancyStart&&ot.add(c)})});for(const i of["keystoneInactive","notableInactive","normalInactive","masteryInactive"]){const o=(t=_.sprites[i])==null?void 0:t[se];Object.keys((o==null?void 0:o.coords)||{}).forEach(c=>o&&(J[c]=o))}for(const i of["keystoneActive","notableActive","normalActive","masteryActiveSelected"]){const o=(n=_.sprites[i])==null?void 0:n[se];Object.keys(o.coords).forEach(c=>o&&o)}for(const i of["background","mastery","masteryConnected","ascendancyBackground","ascendancy","startNode","groupBackground","frame","jewel","line","jewelRadius"]){let o=(l=_.sprites[i])==null?void 0:l[se];o||(o=(a=_.sprites[i])==null?void 0:a[Object.keys(_.sprites[i])[0]]),Object.keys((o==null?void 0:o.coords)||{}).forEach(c=>o&&(A[c]=o))}Ae.set(_),Ee.set(s)},ae=(s,e,t,n,l)=>({x:(Math.abs(_.min_x)+s+t)/l,y:(Math.abs(_.min_y)+e+n)/l}),Tt=(s,e,t)=>{const n=Math.PI/180*t,l=Math.cos(n),a=Math.sin(n),i=l*(e.x-s.x)+a*(e.y-s.y)+s.x,o=l*(e.y-s.y)-a*(e.x-s.x)+s.y;return{x:i,y:o}},Fe=[0,30,45,60,90,120,135,150,180,210,225,240,270,300,315,330],je=[0,10,20,30,40,45,50,60,70,80,90,100,110,120,130,135,140,150,160,170,180,190,200,210,220,225,230,240,250,260,270,280,290,300,310,315,320,330,340,350],Ie=(s,e)=>{var n;const t=(n=_.constants.skillsPerOrbit)==null?void 0:n[s];return t==16?Fe[Fe.length-e]||0:t==40?je[je.length-e]||0:360-360/(t||1)*e},we=(s,e,t,n)=>{if(s.group===void 0||s.orbit===void 0||s.orbitIndex===void 0||!_.groups||!_.constants.orbitRadii)return{x:0,y:0};const l=_.groups[s.group],a=Ie(s.orbit,s.orbitIndex),i=ae(l.x,l.y,e,t,n),o=ae(l.x,l.y-_.constants.orbitRadii[s.orbit],e,t,n);return Tt(i,o,a)},Ct=(s,e)=>Math.sqrt(Math.pow(s.x-e.x,2)+Math.pow(s.y-e.y,2)),{window:ye}=wt;function Ve(s){let e,t,n,l;t=new Rt({props:{width:s[0],height:s[1],$$slots:{default:[Lt]},$$scope:{ctx:s}}}),t.$on("pointerdown",s[5]),t.$on("wheel",s[8]);const a=s[19].default,i=We(a,s,s[21],null);return{c(){e=H("div"),Me(t.$$.fragment),n=Je(),i&&i.c(),this.h()},l(o){e=K(o,"DIV",{style:!0});var c=Z(e);Re(t.$$.fragment,c),n=He(c),i&&i.l(c),c.forEach(E),this.h()},h(){ne(e,"touch-action","none"),ne(e,"cursor",s[2])},m(o,c){q(o,e,c),ve(t,e,null),yt(e,n),i&&i.m(e,null),l=!0},p(o,c){const b={};c&1&&(b.width=o[0]),c&2&&(b.height=o[1]),c&2097168&&(b.$$scope={dirty:c,ctx:o}),t.$set(b),i&&i.p&&(!l||c&2097152)&&Ke(i,a,o,o[21],l?Qe(a,o[21],c,null):Ze(o[21]),null),(!l||c&4)&&ne(e,"cursor",o[2])},i(o){l||(C(t.$$.fragment,o),C(i,o),l=!0)},o(o){Y(t.$$.fragment,o),Y(i,o),l=!1},d(o){o&&E(e),Pe(t),i&&i.d(o)}}}function Lt(s){let e,t;return e=new At({props:{render:s[4]}}),{c(){Me(e.$$.fragment)},l(n){Re(e.$$.fragment,n)},m(n,l){ve(e,n,l),t=!0},p(n,l){const a={};l&16&&(a.render=n[4]),e.$set(a)},i(n){t||(C(e.$$.fragment,n),t=!0)},o(n){Y(e.$$.fragment,n),t=!1},d(n){Pe(e,n)}}}function Ot(s){let e,t,n,l,a=s[0]&&s[1]&&Ve(s);return{c(){e=H("div"),a&&a.c(),this.h()},l(i){e=K(i,"DIV",{class:!0});var o=Z(e);a&&a.l(o),o.forEach(E),this.h()},h(){G(e,"class","w-full h-full max-w-full max-h-full overflow-hidden")},m(i,o){q(i,e,o),a&&a.m(e,null),s[20](e),t=!0,n||(l=[re(ye,"pointerup",s[6]),re(ye,"pointermove",s[7]),re(ye,"resize",s[9])],n=!0)},p(i,[o]){i[0]&&i[1]?a?(a.p(i,o),o&3&&C(a,1)):(a=Ve(i),a.c(),C(a,1),a.m(e,null)):a&&($e(),Y(a,1,1,()=>{a=null}),et())},i(i){t||(C(a),t=!0)},o(i){Y(a),t=!1},d(i){i&&E(e),a&&a.d(),s[20](null),n=!1,gt(l)}}}const Ue="25px Roboto Mono",Xe="17px Roboto Mono",qe=2.6;function Yt(s,e,t){let n,l,a,i;ie(s,Ae,r=>t(17,a=r)),ie(s,Ee,r=>t(18,i=r));let{$$slots:o={},$$scope:c}=e,{clickNode:b=console.log}=e,h=10,u=0,f=0;const w={},k=(r,z,F,j,v=!1)=>{const L=j[z];if(!L)return;const me=L.filename,S=new URL(me).pathname,d=S.substring(S.lastIndexOf("/")+1),p=n+d;p in w||(w[p]=new Image,w[p].src=p);const m=L.coords[z],I=m.w/h*qe,R=m.h/h*qe,P=F.x-I/2,O=F.y-R/2;let M=O;v&&(M=O-R/2),r.drawImage(w[p],m.x,m.y,m.w,m.h,P,M,I,R),v&&(r.save(),r.translate(P,O),r.rotate(Math.PI),r.drawImage(w[p],m.x,m.y,m.w,m.h,-I,-(R/2),I,-R),r.restore())},ue=(r,z,F)=>{const j=[];let v="";return r.split(" ").forEach(L=>{z.measureText(v+L).width<F?v+=" "+L:(j.push(v.trim()),v=L)}),v.length>0&&j.push(v.trim()),j};let y={x:Number.MIN_VALUE,y:Number.MIN_VALUE},B="unset",N,Q=0,W=0,x=0,$=0,g=!1;const de=r=>{g=!0,Q=r.offsetX,W=r.offsetY,x=u,$=f,t(14,y={x:r.offsetX,y:r.offsetY}),N&&b(N)},he=r=>{r.type==="pointerup"&&(g=!1),t(14,y={x:r.offsetX,y:r.offsetY})},it=r=>{g&&(t(12,u=x-(Q-r.offsetX)*h),t(13,f=$-(W-r.offsetY)*h)),t(14,y={x:r.offsetX,y:r.offsetY})},at=r=>{r.deltaY>0?h<30&&(t(12,u+=r.offsetX),t(13,f+=r.offsetY)):h>3&&(t(12,u-=r.offsetX),t(13,f-=r.offsetY)),t(11,h=Math.min(30,Math.max(3,h+r.deltaY/100))),r.preventDefault(),r.stopPropagation(),r.stopImmediatePropagation()};let D,Ne=0,Te=0;const ee=()=>{D&&(t(0,Ne=D.offsetWidth),t(1,Te=D.offsetHeight))};let pe=!1;Se(()=>{new ResizeObserver(ee).observe(D),ee()});function lt(r){be[r?"unshift":"push"](()=>{D=r,t(3,D)})}return s.$$set=r=>{"clickNode"in r&&t(10,b=r.clickNode),"$$scope"in r&&t(21,c=r.$$scope)},s.$$.update=()=>{s.$$.dirty&262144&&(n=`https://go-pob-data.pages.dev/data/${i.replace("_",".")}/tree/assets/`),s.$$.dirty&198656&&(!pe&&a&&(t(16,pe=!0),t(12,u=a.min_x+window.innerWidth/2*h),t(13,f=a.min_y+window.innerHeight/2*h)),ee()),s.$$.dirty&194560&&t(4,l=({context:r,width:z,height:F})=>{const j=window.performance.now();r.clearRect(0,0,z,F),r.fillStyle="#080c11",r.fillRect(0,0,z,F);const v={};Object.keys(oe).forEach(S=>{const d=oe[S],p=ae(d.x,d.y,u,f,h),m=Math.max(...d.orbits),I=parseInt(S);I in ke?k(r,"center"+a.classes[ke[I]].name.toLowerCase(),p,A):I in _e?ot.has(I)&&k(r,"Classes"+_e[I],p,A):m==1?k(r,"PSGroupBackground1",p,A):m==2?k(r,"PSGroupBackground2",p,A):(m==3||d.orbits.length>1)&&k(r,"PSGroupBackground3",p,A,!0)}),Object.keys(X).forEach(S=>{var I;const d=X[S],p=Ie(d.orbit,d.orbitIndex),m=we(d,u,f,h);d.classStartIndex===void 0&&((I=d.out)==null||I.forEach(R=>{if(!X[parseInt(R)])return;const P=Math.min(parseInt(R),parseInt(S)),O=Math.max(parseInt(R),parseInt(S)),M=P+":"+O;if(M in v)return;v[M]=!0;const T=X[parseInt(R)];if(!T||T.isMastery||d.ascendancyName!==T.ascendancyName||T.classStartIndex!==void 0)return;const Ce=Ie(T.orbit,T.orbitIndex),te=we(T,u,f,h);if(r.beginPath(),d.group!=T.group||d.orbit!=T.orbit)r.moveTo(m.x,m.y),r.lineTo(te.x,te.y);else{let V=Math.PI/180-Math.PI/180*p,U=Math.PI/180-Math.PI/180*Ce;V-=Math.PI/2,U-=Math.PI/2;const Le=Math.abs(Math.max(V,U)-Math.min(V,U)),ft=Le>Math.PI?Math.max(V,U):Math.min(V,U),ct=Le>Math.PI?Math.min(V,U):Math.max(V,U),Oe=oe[d.group],Ye=ae(Oe.x,Oe.y,u,f,h);r.arc(Ye.x,Ye.y,a.constants.orbitRadii[d.orbit]/h+1,ft,ct)}r.lineWidth=6/h,r.strokeStyle="#524518",r.stroke()}))});let L;if(Object.keys(X).forEach(S=>{const d=X[S],p=we(d,u,f,h);let m=0;d.classStartIndex!==void 0||(d.isAscendancyStart?k(r,"AscendancyMiddle",p,A):d.isKeystone?(m=110,k(r,d.icon,p,J),k(r,"KeystoneFrameUnallocated",p,A)):d.isNotable?(m=70,k(r,d.icon,p,J),k(r,"NotableFrameUnallocated",p,A)):d.isJewelSocket?(m=70,d.expansionJewel?k(r,"JewelSocketAltNormal",p,A):k(r,"JewelFrameUnallocated",p,A)):d.isMastery?k(r,d.inactiveIcon,p,J):(m=50,k(r,d.icon,p,J),k(r,"PSSkillFrame",p,A))),Ct(p,y)<m/h&&(L=d)}),t(15,N=L),N){const S=N.name,d=(N.stats||[]).map(M=>({text:M,special:!1}));r.font=Ue;const p=r.measureText(S),m=Math.max(p.width+50,600);r.font=Xe;const I=[],R=30;let P=85;d&&d.length>0?d.forEach(M=>{I.length>0&&(P+=5),M.text.split(`
`).forEach(T=>{I.length>0&&(P+=10),ue(T,r,m-R).forEach(te=>{I.push({text:te,offset:P,special:M.special}),P+=20})})}):N.isJewelSocket&&(I.push({text:"Click to select this socket",offset:P,special:!0}),P+=20);const O=55;r.fillStyle="rgba(75,63,24,0.9)",r.fillRect(y.x,y.y,m,O),r.fillStyle="#ffffff",r.font=Ue,r.textAlign="center",r.fillText(S,y.x+m/2,y.y+35),r.fillStyle="rgba(0,0,0,0.8)",r.fillRect(y.x,y.y+O,m,P-O),r.font=Xe,r.textAlign="left",I.forEach(M=>{M.special?r.fillStyle="#8cf34c":r.fillStyle="#ffffff",r.fillText(M.text,y.x+R/2,y.y+M.offset)})}N?t(2,B="pointer"):t(2,B="unset"),r.fillStyle="#ffffff",r.textAlign="right",r.font="12px Roboto Mono";const me=window.performance.now();r.fillText(`${(me-j).toFixed(1)}ms`,z-5,17)})},[Ne,Te,B,D,l,de,he,it,at,ee,b,h,u,f,y,N,pe,a,i,o,lt,c]}class zt extends le{constructor(e){super(),fe(this,e,Yt,Ot,ce,{clickNode:10})}}function Be(s){let e,t;return e=new zt({}),{c(){Me(e.$$.fragment)},l(n){Re(e.$$.fragment,n)},m(n,l){ve(e,n,l),t=!0},i(n){t||(C(e.$$.fragment,n),t=!0)},o(n){Y(e.$$.fragment,n),t=!1},d(n){Pe(e,n)}}}function Gt(s){let e,t,n=s[1]&&s[0]&&Be();return{c(){n&&n.c(),e=ze()},l(l){n&&n.l(l),e=ze()},m(l,a){n&&n.m(l,a),q(l,e,a),t=!0},p(l,[a]){l[1]&&l[0]?n?a&3&&C(n,1):(n=Be(),n.c(),C(n,1),n.m(e.parentNode,e)):n&&($e(),Y(n,1,1,()=>{n=null}),et())},i(l){t||(C(n),t=!0)},o(l){Y(n),t=!1},d(l){n&&n.d(l),l&&E(e)}}}function Dt(s,e,t){let n,l;return ie(s,Ee,a=>t(0,n=a)),ie(s,Ae,a=>t(1,l=a)),Se(()=>{(!l||!n)&&Nt("3_18")}),[n,l]}class Ut extends le{constructor(e){super(),fe(this,e,Dt,Gt,ce,{})}}export{Ut as default};
